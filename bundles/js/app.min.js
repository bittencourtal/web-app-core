!function(){angular.module("mdThemeColorsDSS",[]).factory("mdThemeColorsDSS",["mdThemeColors",function(i){return{init:function(){var e=[],t=Object.getOwnPropertyNames(i);dss.values=dss.values||[],dss.getKeys=function(){return dss.values.select(function(i){return i.key})},t.forEach(function(t,n){var o=Object.getOwnPropertyNames(i[t]);o.forEach(function(n){e.push({key:t+"."+n,value:i[t][n]})})}),e.forEach(function(i){dss.setProperty(i.key,i.value),dss.values.push(i)})}}}])}(),String.prototype.contains=function(i){return this.indexOf(i)>-1},String.prototype.replaceAll=function(i,e){if("."==i)return this.replace(/\./g,e);var t=new RegExp(i,"g");return this.replace(t,e)},function(i){i.isAndroid=function(){var i=navigator.userAgent.toLowerCase();return i.indexOf("android")>-1},i.isIOS=function(){return/iPad|iPhone|iPod/.test(i.navigator.userAgent)&&!i.MSStream}}(window),function(i){var e=["squid-login","squid-feed","squid-mission","squid-checkout","squid-user"];i.squid.app=angular.module("squid-app",i.squid.defaultDependencies.concat(e)),i.squid.app.run(["$rootScope","auth","store","jwtHelper","$location",function(e,t,n,o,a){function r(){a.path(i.LOGIN_ROUTE)}e=e||{},e.pageTitle="",e.setPageTitle=function(i){e.pageTitle=i},e.$on("$locationChangeStart",function(){var e=n.get("token");if(e&&(o.isTokenExpired(e)?$.jStorage.flush():t.authenticate(n.get("profile"),e)),!t.isAuthenticated)return $.jStorage.flush(),void(i.REQUIRE_AUTHENTICATION&&r())}),e.$on("$routeChangeSuccess",function(i,e){e&&e.$$route&&e.$$route.requireLogin&&!t.isAuthenticated&&r()}),t.hookEvents()}])}(window),function(i){function e(i,e){function t(){Object.keys(i._PALETTES).forEach(function(e){var t=i._PALETTES[e],n=[];o[e]=n,Object.keys(t).forEach(function(i){/#[0-9A-Fa-f]{6}|0-9A-Fa-f]{8}\b/.exec(t[i])&&(n[i]=t[i])})})}function n(){e.factory("mdThemeColors",[function(){var e={},n=function(e){return function(){var n=i._THEMES["default"].colors[e],a=n.name;return o[a]||t(),o[a]["default"]=o[a][n.hues["default"]],o[a].hue1=o[a][n.hues["hue-1"]],o[a].hue2=o[a][n.hues["hue-2"]],o[a].hue3=o[a][n.hues["hue-3"]],o[a]}};return Object.defineProperty(e,"primary",{get:n("primary")}),Object.defineProperty(e,"accent",{get:n("accent")}),Object.defineProperty(e,"warn",{get:n("warn")}),Object.defineProperty(e,"background",{get:n("background")}),e}])}var o={};t(),n()}function t(e){i.THEME.CUSTOM&&(e.definePalette(i.THEME.PRIMARY_COLOR.name,i.THEME.PRIMARY_COLOR.value),e._PALETTES[i.THEME.PRIMARY_COLOR.name]=i.THEME.PRIMARY_COLOR.value,e.definePalette(i.THEME.SECONDARY_COLOR.name,i.THEME.SECONDARY_COLOR.value),e._PALETTES[i.THEME.SECONDARY_COLOR.name]=i.THEME.SECONDARY_COLOR.value,e.definePalette(i.THEME.WARN_COLOR.name,i.THEME.WARN_COLOR.value),e._PALETTES[i.THEME.WARN_COLOR.name]=i.THEME.WARN_COLOR.value),e.theme("default").primaryPalette(i.THEME.PRIMARY_COLOR.name).accentPalette(i.THEME.SECONDARY_COLOR.name).warnPalette(i.THEME.WARN_COLOR.name)}i.squid.app.config(["$httpProvider","authProvider","jwtInterceptorProvider","$mdThemingProvider","$mdIconProvider","$provide","$compileProvider",function(n,o,a,r,s,c,u){n.defaults.useXDomain=!0,delete n.defaults.headers.common["X-Requested-With"],o.init({domain:AUTH0_DOMAIN,clientID:AUTH0_CLIENT_ID,loginUrl:i.LOGIN_ROUTE}),a.tokenGetter=function(i){return i.get("token")},n.interceptors.push("jwtInterceptor"),n.interceptors.push("appIdInjector"),u.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|whatsapp):/),t(r),e(r,c)}])}(window),function(i){"use strict";i.squid.app.controller("TemplateController",["$scope","$rootScope","auth","$location","$mdMedia","mdThemeColorsDSS",function(e,t,n,o,a,r){e=e||{},t.pageTitle="",t.secondaryNav=!1,t.isSmallDevice=a("sm"),e.isLoading=!1,e.viewUrl="",e.auth=n,e.$location=o,e.path=o.$$path.split("/")[1],e.toggleObject={item:-1},e.APP_DIR=i.APP_DIR,e.scrollToUp=function(){$("html, body").animate({scrollTop:0},1500)},e.$on("$routeChangeStart",function(){e.isLoading=!0}),e.$on("$routeChangeError",function(){e.isLoading=!1}),e.$on("$routeChangeSuccess",function(i,n){t.pageTitle=n&&n.$$route?n.$$route.pageTitle:"",e.viewUrl=n&&n.$$route?n.$$route.viewUrl:"",t.secondaryNav=!(!n||!n.$$route)&&n.$$route.secondaryNav,e.path=o.$$path.split("/")[1],e.isLoading=!1}),r.init()}])}(window),function(i){"use strict";i.squid.app.directive("toolbar",["$mdSidenav","$location","auth","store","$mdMedia",function(e,t,n,o,a){return{templateUrl:i.APP_DIR+"/directives/toolbar/toolbar.html",restrict:"EA",replace:!0,scope:{},link:function(r,s,c,u){function d(){t.path(i.LOGIN_ROUTE)}function l(){t.path(i.START_VIEW)}r.$mdSidenav=e,r.path=t.$$path.split("/")[1],r.auth=n,r.$location=t,r.isSmallDevice=a("sm"),r.mobileSideMenuUrl=i.APP_DIR+"/directives/toolbar/mobile-side-menu.html",r.getButtonClass=function(i){return{active:r.path==i}},r.goBack=function(){window.history.go(-1)},r.vincularConta=function(){try{var i={userId:n.profile.user_id,redirectUrl:window.location.href,email:n.profile.email},e=JSON.stringify(i),t=btoa(e);window.open("https://campanhas.squidit.com.br/v1/vincular-instagram?data="+t,"_blank")}catch(o){console.log(o)}},r.logout=function(){n.signout(),o.remove("profile"),o.remove("token"),$.jStorage.flush(),i.REQUIRE_AUTHENTICATION?d():l()}}}}])}(window),function(i){i.squid.app.factory("appIdInjector",[function(){var e={request:function(e){return e.headers.app_id=i.APP_ID,e}};return e}])}(window),function(i){i.squid.app.config(["$routeProvider",function(i){i.otherwise({redirectTo:"/mission/actives"})}])}(window),function(i){i.squid.checkout=angular.module("squid-checkout",[])}(window),function(i){i.squid.feed=angular.module("squid-feed",[])}(window),function(i){i.squid.mission=angular.module("squid-mission",[])}(window),function(i){i.squid.login=angular.module("squid-login",[])}(window),function(i){i.squid.user=angular.module("squid-user",[])}(window),function(i){"use strict";i.squid.checkout.controller("CheckoutController",["$scope","checkoutService",function(i,e){function t(t){var n={};t&&(n.minId=t),i.isLoading=!0,e.getCheckouts(n,function(e){i.checkoutList=i.checkoutList.concat(e.data),i.paginationMetadata=e.paginationMetadata,i.isLoading=!1},function(e){i.isLoading=!1})}i.checkoutList=[],i.paginationMetadata={},i.isLoading=!1,i.loadMore=function(){!i.isLoading&&i.paginationMetadata.next&&t(i.paginationMetadata.next.minId)},i.hasPointsAvailable=function(i,e){return i.pointsAvailable>=e.points},t()}])}(window),function(i){"use strict";var e={delay:3e4,close:"OK"};i.squid.checkout.controller("CheckoutPrizeController",["$scope","$rootScope","checkoutService","userService","prizeService","$mdToast","$mdDialog","$routeParams","auth","$location",function(i,t,n,o,a,r,s,c,u,d){function l(){var e=moment(u.profile.birthDate);i.birthDate={day:u.profile.birthDate?e.date():"",month:u.profile.birthDate?e.month()+1:"",year:u.profile.birthDate?e.year():""},i.userMetadata.emailContact=u.profile.emailContact,i.userMetadata.phone=u.profile.phone,i.userMetadata.address=u.profile.address,i.userMetadata.birthDate=u.profile.birthDate,i.userMetadata.gender=u.profile.gender}function f(){var e=new $.Deferred;return a.get({id:c.prizeId},function(t){i.prize=t,e.resolve(t)},function(i){e.reject(i)}),e.promise()}function m(){i.userMetadata.birthDate=moment({day:i.birthDate.day,month:i.birthDate.month-1,year:i.birthDate.year})}function p(){var e=new $.Deferred;return m(),o.update(i.userMetadata,function(i){e.resolve(i)},function(i){e.reject(i)}),e.promise()}function h(){var i=new $.Deferred;return n.checkoutPrize({id:c.prizeId},function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise()}function g(){return t.isSmallDevice?"bottom left":"top right"}function v(t){var n=r.simple().content(t.message).action(e.close).parent($("main").get(0)).hideDelay(e.delay).highlightAction(!1).position(g());r.show(n).then(function(i){}),i.isLoading=!1,d.path("checkout")}function w(t){var n=t.data,o=r.simple().content(n.message).action(e.close).parent($("main").get(0)).hideDelay(e.delay).highlightAction(!1).position(g());r.show(o).then(function(i){}),i.isLoading=!1}function T(){var t=r.simple().content("Não foi possível atualizar as informações de perfil.").action(e.close).parent($("main").get(0)).hideDelay(e.delay).highlightAction(!1).position(g());r.show(t).then(function(i){}),i.isLoading=!1}function E(){i.isLoading=!0,f().then(function(){i.isLoading=!1})}i.auth=u,i.userMetadata={},i.isLoading=!1,i.currentTabIndex=0,i.maxYear=moment().subtract(5,"year").year(),i.prize={},i.onTabSelected=function(e){i.currentTabIndex=e},i.currentStepIsValid=function(){if(!i.userProfile||!i.userProfile.emailContact)return!1;switch(i.currentTabIndex){case 0:return i.userProfile.emailContact.$valid&&i.userProfile.phone.$valid;case 1:return i.userProfile.address.$valid;case 2:return i.userProfile.birthDateDay.$valid&&i.userProfile.birthDateMonth.$valid&&i.userProfile.birthDateYear.$valid;case 3:return i.userProfile.gender.$valid}},i.nextStep=function(){i.currentTabIndex++},i.rescue=function(){i.isLoading=!0,p().then(function(i){h().then(v,w)},T)},E(),i.$watch("auth.profile",function(){l()})}])}(window),function(i){i.squid.checkout.config(["$routeProvider",function(e){e.when("/checkout",{viewUrl:i.APP_DIR+"/modules/checkout/views/checkout.html",templateUrl:i.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"Meus Pontos",requireLogin:!0}).when("/checkout/:prizeId",{viewUrl:i.APP_DIR+"/modules/checkout/views/checkout-prize.html",templateUrl:i.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"Resgatar prêmio",secondaryNav:!0,requireLogin:!0})}])}(window),function(i){"use strict";i.squid.checkout.factory("checkoutService",["$resource",function(i){return i(END_POINT_URL+"/api/checkout/:action/:id",{action:"@action",id:"@id"},{getCheckouts:{method:"GET",params:{action:"missions"}},getVouchersByUser:{method:"GET",params:{action:"vouchers"},isArray:!0},validate:{method:"GET",params:{action:"validate"}},checkoutPrize:{method:"POST",params:{action:"prize"}}})}])}(window),function(i){"use strict";i.squid.checkout.factory("prizeService",["$resource",function(i){return i(END_POINT_URL+"/api/prize/:action/:id",{action:"@action",id:"@id"},{get:{method:"GET"}})}])}(window),function(i){"use strict";i.squid.feed.controller("FeedController",["$scope","feedService",function(i,e){function t(t){var n={};t&&(n.minId=t),i.isLoading=!0,e.getFeedParticipation(n,function(e){i.feedList=i.feedList.concat(e.data),i.paginationMetadata=e.paginationMetadata,i.isLoading=!1},function(e){i.isLoading=!1})}i.feedList=[],i.paginationMetadata={},i.isLoading=!1,i.loadMore=function(){!i.isLoading&&i.paginationMetadata.next&&t(i.paginationMetadata.next.minId)},t()}])}(window),function(i){i.squid.feed.config(["$routeProvider",function(e){e.when("/feed",{viewUrl:i.APP_DIR+"/modules/feed/views/feed.html",templateUrl:i.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"Feed"})}])}(window),function(i){"use strict";i.squid.feed.factory("feedService",["$resource",function(i){return i(END_POINT_URL+"/api/feed/:action/:id",{action:"@action",id:"@id"},{getFeedParticipation:{method:"GET",params:{action:"participation"}},getMissionsActive:{method:"GET",params:{action:"mission"}}})}])}(window),function(i){"use strict";i.squid.mission.controller("ActiveMissionController",["$scope","feedService","$location",function(i,e,t){i.isLoading=!1,function(){i.isLoading=!0,e.getMissionsActive({}).$promise.then(function(i){if(i.data.length){var e=i.data[0];t.path("mission/mission-details/"+e._id)}})["catch"](function(i){console.log(i)}).then(function(){i.isLoading=!1})}()}])}(window),function(i){i.squid.mission.controller("ChallengeController",["$scope","mission","$mdDialog","shareService",function(e,t,n,o){function a(){e.mission.shareText=e.mission.shareText.replaceAll("#","%23")}function r(){o.shareMission({id:e.mission._id})}function s(){n.hide()}e.mission=t,e.isMobile=i.isIOS()||i.isAndroid(),e.urlToShare=window.location.href.replaceAll("/#",""),e.textToShare="",e.descriptionToShare="",e.share=function(){r(),s()},e.closeModal=function(){s()},a()}])}(window),function(i){"use strict";i.squid.mission.controller("MissionDetailsController",["$scope","$rootScope","$routeParams","missionService","participationService","$mdDialog","$timeout",function(e,t,n,o,a,r,s){function c(){var i=new $.Deferred;return e.isLoading=!0,o.getMissionById({id:n.missionId},function(t){e.mission=t,e.isLoading=!1,i.resolve()},function(t){e.isLoading=!1,i.reject()}),i.promise()}function u(i){var e=moment(),t=moment(i),n=moment(t,"DD/MM/YYYY HH:mm:ss").diff(moment(e,"DD/MM/YYYY HH:mm:ss")),o=moment.duration(n),a=Math.floor(o.asDays()),r=moment.utc(n).format("HH"),s=moment.utc(n).format("mm"),c=moment.utc(n).format("ss");return a<=0?"Encerrada":a+" dias "+r+" horas "+s+" minutos e "+c+" segundos."}function d(){e.isLoadingParticipations||e.participations.data.length>0&&!e.participations.minId||0==e.participations.data.length&&!m||(m=!1,e.isLoadingParticipations=!0,a.getMissionParticipations({id:e.mission._id,minId:e.participations.minId,take:12},function(i){e.participations.data=e.participations.data.concat(i.data).distinct(function(i,e){return i._id==e._id}),e.participations.minId=i.paginationMetadata.next?i.paginationMetadata.next.minId:null,e.isLoadingParticipations=!1},function(){e.isLoadingParticipations=!1}))}function l(){setInterval(function(){e.mission&&e.mission.time&&(e.timeLeft=u(e.mission.time.fixedEndDate),e.$apply())},1e3)}function f(){c().then(function(){d(),t.pageTitle="#"+e.mission.hashtag}),l()}var m=!0;e.mission={},e.participations={data:[],minId:""},e.isLoading=!1,e.isLoadingParticipations=!1,e.menuIsOpen=!1,e.timeLeft="--",e.tooltipIsOpen=!1,e.loadMoreParticipations=function(){d()},e.participate=function(t){e.menuIsOpen=!1,r.show({controller:"ParticipateController",templateUrl:i.APP_DIR+"/modules/mission/templates/participate.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,locals:{mission:e.mission}}).then(function(){},function(){})},e.challenge=function(t){e.menuIsOpen=!1,r.show({controller:"ChallengeController",templateUrl:i.APP_DIR+"/modules/mission/templates/challenge.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,locals:{mission:e.mission}}).then(function(){},function(){})},e.toggleMenu=function(){i.isAndroid()&&(e.menuIsOpen=!e.menuIsOpen)},e.$watch("menuIsOpen",function(i){i?s(function(){e.tooltipIsOpen=!0},250):e.tooltipIsOpen=!1}),f()}])}(window),function(i){i.squid.mission.controller("ParticipateController",["$scope","mission","$mdDialog",function(e,t,n){e.mission=t,e.isMobile=i.isIOS()||i.isAndroid(),e.openInstagram=function(){i.isIOS()?window.location="instagram://camera":window.location="intent://instagram.com/_n/mainfeed/#Intent;package=com.instagram.android;scheme=https;end",n.hide()},e.closeModal=function(){n.hide()}}])}(window),function(i){i.squid.mission.config(["$routeProvider",function(e){e.when("/mission/actives",{viewUrl:i.APP_DIR+"/modules/mission/views/actives.html",templateUrl:i.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"Missões"}).when("/mission/mission-details/:missionId",{viewUrl:i.APP_DIR+"/modules/mission/views/mission-details.html",templateUrl:i.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"",secondaryNav:!0})}])}(window),function(i){"use strict";i.squid.mission.factory("missionService",["$resource",function(i){return i(END_POINT_URL+"/api/mission/:action/:id",{action:"@action",id:"@id"},{getMissionById:{method:"GET"}})}])}(window),function(i){"use strict";i.squid.mission.factory("participationService",["$resource",function(i){return i(END_POINT_URL+"/api/participation/:action/:id",{action:"@action",id:"@id"},{getMissionParticipations:{method:"GET",params:{action:"mission"}},getUserParticipations:{method:"GET",params:{action:"user"}}})}])}(window),function(i){"use strict";i.squid.mission.factory("shareService",["$resource",function(i){return i(END_POINT_URL+"/api/share/:action/:id",{action:"@action",id:"@id"},{shareMission:{method:"POST",params:{action:"mission"}}})}])}(window),function(i){i.squid.login.controller("LoginController",["$scope","auth","$location","store",function(e,t,n,o){function a(){t.config.auth0lib.$container=null,t.signin({connections:["instagram"],container:"login-box",dict:c},function(e,t){o.set("profile",e),o.set("token",t),r(e)?n.path(i.START_VIEW):n.path("/register")},function(i){})}function r(i){return i.birthDate&&i.gender}function s(){t.isAuthenticated&&n.path(i.START_VIEW)}var c={loadingTitle:"carregando...",close:"fechar",signin:{wrongEmailPasswordErrorText:"E-mail ou senha inválidos.",serverErrorText:"Você não está autorizado.",strategyEmailInvalid:"O e-mail é invalido.",strategyDomainInvalid:"O domínio {domain} não foi configurado."},signup:{serverErrorText:"Não foi possível se cadastrar."},reset:{serverErrorText:"Não foi possível resetar a senha."}};s(),a()}])}(window),function(i){i.squid.login.config(["$routeProvider",function(e){e.when("/login",{viewUrl:i.APP_DIR+"/modules/login/views/index.html",templateUrl:i.VIEWS.TEMPLATES.LOGIN,pageTitle:"Login",secondaryNav:!0})}])}(window),function(i){i.squid.user.config(["$routeProvider",function(e){e.when("/my-profile",{viewUrl:i.APP_DIR+"/modules/user/views/my-profile.html",templateUrl:i.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"Meu Perfil"})}])}(window),function(i){"use strict";i.squid.user.controller("MyProfileController",["$scope","auth","userService","$location","participationService","checkoutService","userStatisticsService",function(i,e,t,n,o,a,r){function s(){r.getUserProfileStatistics(function(e){i.userStatistics=e})}function c(){a.getVouchersByUser(function(e){i.vouchers=e})}function u(){i.isLoadingParticipations||i.participations.data.length>0&&!i.participations.minId||0==i.participations.data.length&&!l||(l=!1,i.isLoadingParticipations=!0,o.getUserParticipations({id:e.profile.user_id,minId:i.participations.minId,take:12},function(e){i.participations.data=i.participations.data.concat(e.data).distinct(function(i,e){return i._id==e._id}),i.participations.minId=e.paginationMetadata.next?e.paginationMetadata.next.minId:null,i.isLoadingParticipations=!1},function(){i.isLoadingParticipations=!1}))}function d(){e.isAuthenticated&&(u(),c(),s())}var l=!0;i.isLoadingParticipations=!1,i.auth=e,i.selectedTabIndex=0,i.isLoading=!1,i.userStatistics={},i.maxYear=moment().subtract(14,"years").year(),i.vouchers=[],i.participations={data:[],minId:""},i.getVoucherUsedLabel=function(i){return i?"Usado":"Não usado"},i.loadMoreParticipations=function(){e.isAuthenticated&&u()},d()}])}(window),function(i){"use strict";i.squid.user.factory("userService",["$resource",function(i){return i(END_POINT_URL+"/api/user/:action/:id",{action:"@action",id:"@id"},{email:{method:"PUT",params:{action:"email"}},update:{method:"PUT"}})}])}(window),function(i){"use strict";i.squid.user.factory("userStatisticsService",["$resource",function(i){return i(END_POINT_URL+"/api/statistics/user/:action/:id",{action:"@action",id:"@id"},{getUserProfileStatistics:{method:"GET",params:{action:"me"}}})}])}(window),function(i){"use strict";i.squid.checkout.controller("CheckoutRescueModalController",["$scope","$modalInstance","prize","auth","checkoutService","userService",function(i,e,t,n,o,a){function r(){i.email!=n.profile.email?a.email({email:i.email},function(i){s()},function(e){i.validateStatus=e.data.message}):s()}function s(){o.getPrize({id:t.id},function(e){i.validateStatus=e.message},function(e){i.validateStatus=e.data.message,e.data.message.contains("e-mail")&&(l=!0)})}function c(){o.validate({id:t.id},function(e){i.validateStatus=e.status,e.status.contains("ok")&&(d=!0)},function(e){i.validateStatus=e.data.message})}function u(){c()}i.prize=t,i.email=n.profile.email,i.validateStatus="carregando...";var d=!1,l=!1;i.rescue=function(){r()},i.cancel=function(){e.dismiss("cancel")},u()}])}(window);