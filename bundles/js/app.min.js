!function(){angular.module("mdThemeColorsDSS",[]).factory("mdThemeColorsDSS",["mdThemeColors",function(e){return{init:function(){var t=[],i=Object.getOwnPropertyNames(e);dss.values=dss.values||[],dss.getKeys=function(){return dss.values.select(function(e){return e.key})},i.forEach(function(i,n){var o=Object.getOwnPropertyNames(e[i]);o.forEach(function(n){t.push({key:i+"."+n,value:e[i][n]})})}),t.forEach(function(e){dss.setProperty(e.key,e.value),dss.values.push(e)})}}}])}(),String.prototype.contains=function(e){return this.indexOf(e)>-1},String.prototype.replaceAll=function(e,t){if("."==e)return this.replace(/\./g,t);var i=new RegExp(e,"g");return this.replace(i,t)},function(e){e.isAndroid=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("android")>-1},e.isIOS=function(){return/iPad|iPhone|iPod/.test(e.navigator.userAgent)&&!e.MSStream}}(window),function(e){var t=["squid-login","squid-feed","squid-mission","squid-checkout","squid-user","squid-workflow"];e.squid.app=angular.module("squid-app",e.squid.defaultDependencies.concat(t)),e.squid.app.run(["$rootScope","auth","store","jwtHelper","$location","WorkflowInitializer",function(t,i,n,o,a,r){function s(){a.path(e.APP_CONFIG.LOGIN_ROUTE)}function c(){a.path(e.APP_CONFIG.START_VIEW)}function u(e){return e&&e.$$route&&e.$$route.requireLogin}function d(){i.signout(),n.remove("profile"),n.remove("token"),$.jStorage.flush(),e.APP_CONFIG.REQUIRE_AUTHENTICATION?s():c()}t=t||{},t.pageTitle="",t.setPageTitle=function(e){t.pageTitle=e},t.$on("$locationChangeStart",function(){var t=n.get("token");if(t&&(o.isTokenExpired(t)?$.jStorage.flush():i.authenticate(n.get("profile"),t)),!i.isAuthenticated)return $.jStorage.flush(),void(e.APP_CONFIG.REQUIRE_AUTHENTICATION&&s())}),t.$on("$routeChangeSuccess",function(t,n){r.initWorkflows(e.APP_CONFIG.WORKFLOWS.ROUTES.CHANGED)["catch"](d),u(n)&&!i.isAuthenticated&&s()}),i.hookEvents()}])}(window),function(e){function t(e,t){function i(){Object.keys(e._PALETTES).forEach(function(t){var i=e._PALETTES[t],n=[];o[t]=n,Object.keys(i).forEach(function(e){/#[0-9A-Fa-f]{6}|0-9A-Fa-f]{8}\b/.exec(i[e])&&(n[e]=i[e])})})}function n(){t.factory("mdThemeColors",[function(){var t={},n=function(t){return function(){var n=e._THEMES["default"].colors[t],a=n.name;return o[a]||i(),o[a]["default"]=o[a][n.hues["default"]],o[a].hue1=o[a][n.hues["hue-1"]],o[a].hue2=o[a][n.hues["hue-2"]],o[a].hue3=o[a][n.hues["hue-3"]],o[a]}};return Object.defineProperty(t,"primary",{get:n("primary")}),Object.defineProperty(t,"accent",{get:n("accent")}),Object.defineProperty(t,"warn",{get:n("warn")}),Object.defineProperty(t,"background",{get:n("background")}),t}])}var o={};i(),n()}function i(t){e.APP_CONFIG.THEME.CUSTOM&&(t.definePalette(e.APP_CONFIG.THEME.PRIMARY_COLOR.name,e.APP_CONFIG.THEME.PRIMARY_COLOR.value),t._PALETTES[e.APP_CONFIG.THEME.PRIMARY_COLOR.name]=e.APP_CONFIG.THEME.PRIMARY_COLOR.value,t.definePalette(e.APP_CONFIG.THEME.SECONDARY_COLOR.name,e.APP_CONFIG.THEME.SECONDARY_COLOR.value),t._PALETTES[e.APP_CONFIG.THEME.SECONDARY_COLOR.name]=e.APP_CONFIG.THEME.SECONDARY_COLOR.value,t.definePalette(e.APP_CONFIG.THEME.WARN_COLOR.name,e.APP_CONFIG.THEME.WARN_COLOR.value),t._PALETTES[e.APP_CONFIG.THEME.WARN_COLOR.name]=e.APP_CONFIG.THEME.WARN_COLOR.value),t.theme("default").primaryPalette(e.APP_CONFIG.THEME.PRIMARY_COLOR.name).accentPalette(e.APP_CONFIG.THEME.SECONDARY_COLOR.name).warnPalette(e.APP_CONFIG.THEME.WARN_COLOR.name)}e.squid.app.config(["$httpProvider","authProvider","jwtInterceptorProvider","$mdThemingProvider","$mdIconProvider","$provide","$compileProvider","$sceProvider",function(n,o,a,r,s,c,u,d){n.defaults.useXDomain=!0,delete n.defaults.headers.common["X-Requested-With"],o.init({domain:e.APP_CONFIG.AUTH0.DOMAIN,clientID:e.APP_CONFIG.AUTH0.CLIENT_ID,loginUrl:e.APP_CONFIG.LOGIN_ROUTE}),a.tokenGetter=function(e){return e.get("token")},n.interceptors.push("jwtInterceptor"),n.interceptors.push("appIdInjector"),n.interceptors.push("corsHeaderFilterInjector"),u.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|whatsapp):/),d.enabled(!1),i(r),t(r,c)}])}(window),function(e){"use strict";e.squid.app.controller("TemplateController",["$scope","$rootScope","auth","$location","$mdMedia","mdThemeColorsDSS",function(t,i,n,o,a,r){t=t||{},i.pageTitle="",i.secondaryNav=!1,i.isSmallDevice=a("sm"),t.isLoading=!1,t.viewUrl="",t.auth=n,t.$location=o,t.path=o.$$path.split("/")[1],t.toggleObject={item:-1},t.APP_DIR=e.APP_CONFIG.APP_DIR,t.scrollToUp=function(){$("html, body").animate({scrollTop:0},1500)},t.$on("$routeChangeStart",function(){t.isLoading=!0}),t.$on("$routeChangeError",function(){t.isLoading=!1}),t.$on("$routeChangeSuccess",function(e,n){i.pageTitle=n&&n.$$route?n.$$route.pageTitle:"",t.viewUrl=n&&n.$$route?n.$$route.viewUrl:"",i.secondaryNav=!(!n||!n.$$route)&&n.$$route.secondaryNav,t.path=o.$$path.split("/")[1],t.isLoading=!1}),r.init()}])}(window),function(e){"use strict";e.squid.app.factory("addressService",["$resource",function(e){return e("https://viacep.com.br/ws/:cep/json/",{cep:"@cep"})}])}(window),function(e){"use strict";e.squid.app.directive("toolbar",["$rootScope","$mdSidenav","$location","auth","store","$mdMedia","AboutCampaignModalService","feedService","uniqueCampaignService",function(t,i,n,o,a,r,s,c,u){return{templateUrl:e.APP_CONFIG.APP_DIR+"/directives/toolbar/toolbar.html",restrict:"EA",replace:!0,scope:{},link:function(t,c,d,l){function f(){o.signout(),a.remove("profile"),a.remove("token"),$.jStorage.flush(),p()}function p(){n.path(e.LOGIN_ROUTE)}function m(){n.path(e.START_VIEW)}function g(){APP_CONFIG.CAMPAIGNS.UNIQUE_CAMPAIGN.IS_UNIQUE&&u.getUniqueCampaign().then(function(e){t.uniqueCampaign=e})}t.APP_CONFIG=e.APP_CONFIG,t.$mdSidenav=i,t.path=n.$$path.split("/")[1],t.auth=o,t.$location=n,t.uniqueCampaign=null,t.isSmallDevice=r("sm"),t.mobileSideMenuUrl=e.APP_CONFIG.APP_DIR+"/directives/toolbar/mobile-side-menu.html",t.getButtonClass=function(e){return{active:t.path==e}},t.goBack=function(){window.history.go(-1)},t.vincularConta=function(){try{var e={userId:o.profile.user_id,redirectUrl:window.location.href,email:o.profile.email},t=JSON.stringify(e),i=btoa(t);window.open("https://campanhas.squidit.com.br/v1/vincular-instagram?data="+i,"_blank")}catch(n){console.log(n)}},t.goToUniqueCampaign=function(){return t.uniqueCampaign?void u.redirectToUniqueCampaign(t.uniqueCampaign):u.notifyNotHaveCampaign()},t.openAboutCampaign=function(){s.openDialog(o.profile).then(function(){},f)},t.logout=function(){o.signout(),a.remove("profile"),a.remove("token"),$.jStorage.flush(),e.APP_CONFIG.REQUIRE_AUTHENTICATION?p():m()},g()}}}])}(window),function(e){e.squid.app.factory("appIdInjector",[function(){return{request:function(t){return t.headers.app_id=e.APP_CONFIG.APP_ID(),t}}}])}(window),function(e){e.squid.app.factory("corsHeaderFilterInjector",[function(){function t(t){return t.startsWith(e.APP_CONFIG.END_POINT_URL())||t.startsWith(e.APP_CONFIG.CAMPAIGN_END_POINT_URL())||t.startsWith(e.APP_CONFIG.SPIDERMAN_END_POINT_URL())}return{request:function(e){return t(e.url)?e:(delete e.headers.app_id,delete e.headers.Authorization,e)}}}])}(window),function(e){"use strict";e.squid.app.factory("syncPromise",["$q",function(e){return function(t){return function(i){var n=e.defer();return n.resolve(t(i)),n.promise}}}])}(window),function(e){e.squid.app.config(["$routeProvider",function(t){t.otherwise({redirectTo:e.APP_CONFIG.START_VIEW})}])}(window),function(e){e.squid.checkout=angular.module("squid-checkout",[])}(window),function(e){e.squid.feed=angular.module("squid-feed",[])}(window),function(e){e.squid.mission=angular.module("squid-mission",[])}(window),function(e){e.squid.user=angular.module("squid-user",[]),e.squid.user.controllers={}}(window),function(e){e.squid.login=angular.module("squid-login",[]),e.squid.login.controllers={}}(window),function(e){e.squid.campaign=angular.module("squid-campaign",[]),e.squid.campaign.controllers={}}(window),function(e){e.squid.workflow=angular.module("squid-workflow",[]),e.squid.workflow.controllers={},e.squid.workflow.models={}}(window),function(e){"use strict";e.squid.checkout.controller("CheckoutController",["$scope","checkoutService",function(e,t){function i(i){var n={};i&&(n.minId=i),e.isLoading=!0,t.getCheckouts(n,function(t){e.checkoutList=e.checkoutList.concat(t.data),e.paginationMetadata=t.paginationMetadata,e.isLoading=!1},function(t){e.isLoading=!1})}e.checkoutList=[],e.paginationMetadata={},e.isLoading=!1,e.loadMore=function(){!e.isLoading&&e.paginationMetadata.next&&i(e.paginationMetadata.next.minId)},e.hasPointsAvailable=function(e,t){return e.pointsAvailable>=t.points},i()}])}(window),function(e){"use strict";var t={delay:3e4,close:"OK"};e.squid.checkout.controller("CheckoutPrizeController",["$scope","$rootScope","checkoutService","userService","prizeService","$mdToast","$mdDialog","$routeParams","auth","$location","$q",function(e,i,n,o,a,r,s,c,u,d,l){function f(){return i.isSmallDevice?"bottom left":"top right"}function p(){var t=l.defer();return a.get({id:c.prizeId},function(i){e.prize=i,t.resolve(i)},t.reject),t.promise}function m(){var e=l.defer();return n.checkoutPrizeWithoutEmailValidation({id:c.prizeId},e.resolve,e.reject),e.promise}function g(i){var n=r.simple().content(i.message).action(t.close).parent($("main").get(0)).hideDelay(t.delay).highlightAction(!1).position(f());r.show(n).then(function(e){}),e.isLoading=!1,d.path("checkout")}function h(i){if(e.isLoading=!1,i){var n=i.data,o=r.simple().content(n.message).action(t.close).parent($("main").get(0)).hideDelay(t.delay).highlightAction(!1).position(f());r.show(o).then(function(e){})}}function P(){e.isLoading=!0,p().then(function(){e.isLoading=!1})}e.auth=u,e.userMetadata={},e.isLoading=!1,e.prize={},e.saveUserMetadata=function(){},e.rescue=function(){e.isLoading=!0,e.saveUserMetadata().then(m).then(g)["catch"](h)},P()}])}(window),function(e){e.squid.checkout.config(["$routeProvider",function(t){t.when("/checkout",{viewUrl:e.APP_CONFIG.APP_DIR+"/modules/checkout/views/checkout.html",templateUrl:e.APP_CONFIG.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"Meus Pontos",requireLogin:!0}).when("/checkout/:prizeId",{viewUrl:e.APP_CONFIG.APP_DIR+"/modules/checkout/views/checkout-prize.html",templateUrl:e.APP_CONFIG.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"Resgatar prêmio",secondaryNav:!0,requireLogin:!0})}])}(window),function(e){"use strict";e.squid.checkout.factory("checkoutService",["$resource",function(t){return t(e.APP_CONFIG.END_POINT_URL()+"/api/checkout/:action/:id",{action:"@action",id:"@id"},{getCheckouts:{method:"GET",params:{action:"missions"}},getVouchersByUser:{method:"GET",params:{action:"vouchers"},isArray:!0},validate:{method:"GET",params:{action:"validate"}},checkoutPrize:{method:"POST",params:{action:"prize"}},checkoutPrizeWithoutEmailValidation:{method:"POST",params:{action:"prizeWithoutEmailValidation"}}})}])}(window),function(e){"use strict";e.squid.checkout.factory("prizeService",["$resource",function(t){return t(e.APP_CONFIG.END_POINT_URL()+"/api/prize/:action/:id",{action:"@action",id:"@id"},{get:{method:"GET"}})}])}(window),function(e){"use strict";var t=[];e.squid.feed.controller("FeedController",["$scope","feedService","$element","$timeout","$q",function(e,i,n,o,a){function r(){function e(e){return t.any(function(t){return t.currentSrc==e.currentSrc})}function i(t){e(t)||t.play()}function o(e,t,i,n){return e<t&&i>n}function a(){var e=$(window).scrollTop()+s,t=$(window).scrollTop()+$(window).height()-s;r.each(function(n,a){var r=$(this).offset().top,s=$(this).height()+r,c=$(this).get(0);o(e,s,t,r)?i(c):c.pause()})}var r=$(n).find("video").not("[autoplay='autoplay']"),s=80;$(document).unbind("scroll"),$(document).on("scroll",a)}function s(){function e(e,t){var i=$(t).closest(".card");t.onplay=function(){i.addClass("video-playing")},t.onpause=function(){i.removeClass("video-playing")}}var t=$(n).find("video");$.each(t,e)}function c(){var e=a.defer();return o(function(){s(),r(),e.resolve()},100),e.promise}function u(t){var i=a.defer();return e.feedList=e.feedList.concat(t.data),e.paginationMetadata=t.paginationMetadata,i.resolve(),i.promise}function d(){e.isLoading=!1}function l(t){e.isLoading=!0,f(t).then(u).then(c).then(d)}function f(e){var t=a.defer(),n={status:"approved"};return e&&(n.minId=e),i.getFeedParticipation(n,t.resolve,t.reject),t.promise}e.feedList=[],e.paginationMetadata={},e.isLoading=!1,e.getCardClass=function(e){var t={};return t["card-feed-"+e.mediaType]=!0,t},e.playVideo=function(e,i){var n=$(e.currentTarget).get(0);if(n)return n.paused?n.play():(t.push(n),t=t.distinct(function(e,t){return e.currentSrc==t.currentSrc}),n.pause())},e.loadMore=function(){!e.isLoading&&e.paginationMetadata.next&&l(e.paginationMetadata.next.minId)},l()}])}(window),function(e){e.squid.feed.config(["$routeProvider",function(t){t.when("/feed",{viewUrl:e.APP_CONFIG.APP_DIR+"/modules/feed/views/feed.html",templateUrl:e.APP_CONFIG.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"Feed"})}])}(window),function(e){"use strict";e.squid.feed.factory("feedService",["$resource",function(t){return t(e.APP_CONFIG.END_POINT_URL()+"/api/feed/:action/:id",{action:"@action",id:"@id"},{getFeedParticipation:{method:"GET",params:{action:"participation"}},getMissionsActive:{method:"GET",params:{action:"mission"}}})}])}(window),function(e){"use strict";e.squid.mission.controller("ActiveMissionController",["$scope","feedService","$mdToast","uniqueCampaignService",function(e,t,i,n){function o(){e.isLoading=!0,n.getUniqueCampaign().then(function(t){n.redirectToUniqueCampaign(t),e.isLoading=!1})["catch"](function(){n.notifyNotHaveCampaign(),e.isLoading=!1})}function a(i){var n={};i&&(n.minId=i),e.isLoading=!0,t.getMissionsActive(n,function(t){e.feedList=e.feedList.concat(t.data),e.paginationMetadata=t.paginationMetadata,e.isLoading=!1},function(t){e.isLoading=!1})}function r(){APP_CONFIG.CAMPAIGNS.UNIQUE_CAMPAIGN.IS_UNIQUE?o():a()}e.feedList=[],e.paginationMetadata={},e.isLoading=!1,e.loadMore=function(){!e.isLoading&&e.paginationMetadata.next&&a(e.paginationMetadata.next.minId)},r()}])}(window),function(e){e.squid.mission.controller("ChallengeController",["$scope","mission","$mdDialog","shareService",function(t,i,n,o){function a(){t.mission.shareText=t.mission.shareText.replaceAll("#","%23")}function r(){o.shareMission({id:t.mission._id})}function s(){n.hide()}t.mission=i,t.isMobile=e.isIOS()||e.isAndroid(),t.urlToShare=window.location.href.replaceAll("/#",""),t.textToShare="",t.descriptionToShare="",t.share=function(){r(),s()},t.closeModal=function(){s()},a()}])}(window),function(e){"use strict";e.squid.mission.controller("MissionDetailsController",["$scope","$rootScope","$routeParams","missionService","participationService","$mdDialog","$timeout",function(t,i,n,o,a,r,s){function c(){var e=new $.Deferred;return t.isLoading=!0,o.getMissionById({id:n.missionId},function(i){t.mission=i,t.isLoading=!1,e.resolve()},function(i){t.isLoading=!1,e.reject()}),e.promise()}function u(e){var t=moment(),i=moment(e),n=moment(i,"DD/MM/YYYY HH:mm:ss").diff(moment(t,"DD/MM/YYYY HH:mm:ss")),o=moment.duration(n),a=Math.floor(o.asDays()),r=moment.utc(n).format("HH"),s=moment.utc(n).format("mm"),c=moment.utc(n).format("ss");return a<=0?"Encerrada":a+" dias "+r+" horas "+s+" minutos e "+c+" segundos."}function d(){t.isLoadingParticipations||t.participations.data.length>0&&!t.participations.minId||0==t.participations.data.length&&!p||(p=!1,t.isLoadingParticipations=!0,a.getMissionParticipations({id:t.mission._id,minId:t.participations.minId,take:12,status:"approved"},function(e){t.participations.data=t.participations.data.concat(e.data).distinct(function(e,t){return e._id==t._id}),t.participations.minId=e.paginationMetadata.next?e.paginationMetadata.next.minId:null,t.isLoadingParticipations=!1},function(){t.isLoadingParticipations=!1}))}function l(){setInterval(function(){t.mission&&t.mission.time&&(t.timeLeft=u(t.mission.time.fixedEndDate),t.$apply())},1e3)}function f(){c().then(function(){d(),i.pageTitle="#"+t.mission.hashtag}),l()}var p=!0;t.mission={},t.participations={data:[],minId:""},t.isLoading=!1,t.isLoadingParticipations=!1,t.menuIsOpen=!1,t.timeLeft="--",t.tooltipIsOpen=!1,t.loadMoreParticipations=function(){d()},t.participate=function(i){t.menuIsOpen=!1,r.show({controller:"ParticipateController",templateUrl:e.APP_CONFIG.APP_DIR+"/modules/mission/templates/participate.html",parent:angular.element(document.body),targetEvent:i,clickOutsideToClose:!0,locals:{mission:t.mission}}).then(function(){},function(){})},t.challenge=function(i){t.menuIsOpen=!1,r.show({controller:"ChallengeController",templateUrl:e.APP_CONFIG.APP_DIR+"/modules/mission/templates/challenge.html",parent:angular.element(document.body),targetEvent:i,clickOutsideToClose:!0,locals:{mission:t.mission}}).then(function(){},function(){})},t.toggleMenu=function(){e.isAndroid()&&(t.menuIsOpen=!t.menuIsOpen)},t.$watch("menuIsOpen",function(e){e?s(function(){t.tooltipIsOpen=!0},250):t.tooltipIsOpen=!1}),f()}])}(window),function(e){e.squid.mission.controller("ParticipateController",["$scope","mission","$mdDialog",function(t,i,n){t.mission=i,t.isMobile=e.isIOS()||e.isAndroid(),t.openInstagram=function(){e.isIOS()?window.location="instagram://camera":window.location="intent://instagram.com/_n/mainfeed/#Intent;package=com.instagram.android;scheme=https;end",n.hide()},t.closeModal=function(){n.hide()}}])}(window),function(e){e.squid.mission.config(["$routeProvider",function(t){t.when("/mission/actives",{viewUrl:e.APP_CONFIG.APP_DIR+"/modules/mission/views/actives.html",templateUrl:e.APP_CONFIG.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"Missões"}).when("/mission/mission-details/:missionId",{viewUrl:e.APP_CONFIG.APP_DIR+"/modules/mission/views/mission-details.html",templateUrl:e.APP_CONFIG.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"",secondaryNav:!0})}])}(window),function(e){"use strict";e.squid.mission.factory("missionService",["$resource",function(t){return t(e.APP_CONFIG.END_POINT_URL()+"/api/mission/:action/:id",{action:"@action",id:"@id"},{getMissionById:{method:"GET"}})}])}(window),function(e){"use strict";e.squid.mission.factory("participationService",["$resource",function(t){return t(e.APP_CONFIG.END_POINT_URL()+"/api/participation/:action/:id",{action:"@action",id:"@id"},{getMissionParticipations:{method:"GET",params:{action:"mission"}},getUserParticipations:{method:"GET",params:{action:"user"}}})}])}(window),function(e){"use strict";e.squid.mission.factory("shareService",["$resource",function(t){return t(e.APP_CONFIG.END_POINT_URL()+"/api/share/:action/:id",{action:"@action",id:"@id"},{shareMission:{method:"POST",params:{action:"mission"}}})}])}(window),function(e){"use strict";var t={delay:1e4,close:"OK"};e.squid.mission.factory("uniqueCampaignService",["$rootScope","$mdToast","$q","$location","feedService",function(e,i,n,o,a){function r(){return e.isSmallDevice?"bottom left":"top right"}function s(){var e=i.simple().content("Não há campanha cadastrada no momento.").action(t.close).parent($("main").get(0)).hideDelay(t.delay).highlightAction(!1).position(r());i.show(e).then(function(e){})}function c(){var e=n.defer();return a.getMissionsActive(function(t){if(!t)return e.reject();var i=t.data.first();return i?void e.resolve(i):e.reject()},e.reject),e.promise}function u(e){o.path("mission/mission-details/"+e._id)}return{getUniqueCampaign:c,notifyNotHaveCampaign:s,redirectToUniqueCampaign:u}}])}(window),function(e){"use strict";var t={delay:1e4,close:"OK"};e.squid.user.controller("MyProfileController",["$scope","$rootScope","auth","userService","$location","participationService","checkoutService","userStatisticsService","$mdToast",function(e,i,n,o,a,r,s,c,u){function d(){return i.isSmallDevice?"bottom left":"top right"}function l(){c.getUserProfileStatistics(function(t){e.userStatistics=t})}function f(){s.getVouchersByUser(function(t){e.vouchers=t})}function p(){return e.isLoadingParticipations||e.participations.data.length>0&&!e.participations.minId||0==e.participations.data.length&&!P}function m(e){var i=u.simple().content("Dados salvos :)").action(t.close).parent($("main").get(0)).hideDelay(t.delay).highlightAction(!1).position(d());u.show(i).then(function(e){})}function g(){p()||(P=!1,e.isLoadingParticipations=!0,r.getUserParticipations({id:n.profile.user_id,minId:e.participations.minId,take:12},function(t){e.participations.data=e.participations.data.concat(t.data).distinct(function(e,t){return e._id==t._id}),e.participations.minId=t.paginationMetadata.next?t.paginationMetadata.next.minId:null,e.isLoadingParticipations=!1},function(){e.isLoadingParticipations=!1}))}function h(){n.isAuthenticated&&(g(),f(),l())}var P=!0;e.isSaving=!1,e.isLoadingParticipations=!1,e.auth=n,e.userMetadata={},e.selectedTabIndex=0,e.isLoading=!1,e.userStatistics={},e.vouchers=[],e.participations={data:[],minId:""},e.getVoucherUsedLabel=function(e){return e?"Usado":"Não usado"},e.loadMoreParticipations=function(){n.isAuthenticated&&g()},e.save=function(){e.saveUserMetadata().then(m)},e.saveUserMetadata=function(){},e.getSaveButtonLabel=function(){return e.isSaving?"Salvando...":"Salvar"},h()}])}(window),function(e){function t(e,t,n,o,a,r){function s(){return t.isSmallDevice?"bottom left":"top right"}function c(e){return f.test(e)}function u(){e.isLoading=!1,n.hide()}function d(){e.isLoading=!1;var t=o.simple().content("Não foi possível salvar os dados, contate o administrador.").action(i.close).parent($("main").get(0)).hideDelay(i.delay).highlightAction(!1).position(s());o.show(t)}function l(){var e=o.simple().content("Insira um e-mail válido.").action(i.close).parent($("main").get(0)).hideDelay(i.delay).highlightAction(!1).position(s());o.show(e)}var f=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;e.isLoading=!1,e.userMetadata=r.getUserMetadata()||{},e.save=function(t){return c(t.email)?(e.isLoading=!0,void a.updateUserMetadata(t,u,d)):l()}}var i={delay:1e4,close:"OK"};e.squid.user.controllers.UserMetadataDialogController=t,e.squid.user.controller("UserMetadataDialogController",["$scope","$rootScope","$mdDialog","$mdToast","squidSpidermanService","userMetadataHelper",t])}(window),function(e){e.squid.user.config(["$routeProvider",function(t){t.when("/my-profile",{viewUrl:e.APP_CONFIG.APP_DIR+"/modules/user/views/my-profile.html",templateUrl:e.APP_CONFIG.VIEWS.TEMPLATES.DEFAULT(),pageTitle:"Meu Perfil"})}])}(window),function(e){"use strict";e.squid.user.factory("squidSpidermanService",["$resource",function(t){return t(e.APP_CONFIG.SPIDERMAN_END_POINT_URL()+"/:action/:id",{action:"@action",id:"@id"},{updateUserMetadata:{method:"PATCH",params:{action:"usermetadata"}},getUserMetadata:{method:"GET",params:{action:"usermetadata"}}})}])}(window),function(e){"use strict";e.squid.user.factory("userService",["$resource",function(t){return t(e.APP_CONFIG.END_POINT_URL()+"/api/user/:action/:id",{action:"@action",id:"@id"},{email:{method:"PUT",params:{action:"email"}},update:{method:"PUT"}})}])}(window),function(e){"use strict";e.squid.user.factory("userStatisticsService",["$resource",function(t){return t(e.APP_CONFIG.END_POINT_URL()+"/api/statistics/user/:action/:id",{action:"@action",id:"@id"},{getUserProfileStatistics:{method:"GET",params:{action:"me"}}})}])}(window),function(e){"use strict";e.squid.user.factory("userMetadataHelper",["store",function(t){function i(){return t.get("profile")}function n(){var e=o();return!!e&&e.acceptedTerms}function o(){var t=i();return t&&t.user_metadata&&t.user_metadata.infos?t.user_metadata.infos.first(function(t){return t.channelId==e.APP_CONFIG.APP_ID()}):null}return{getProfile:i,getUserMetadata:o,termsIsAccepted:n}}])}(window),function(e){e.squid.campaign.controllers,e.squid.login.controllers;e.squid.login.controller("LoginController",["$scope","$rootScope","auth","$location","store","$mdDialog","$mdToast","$q","userService","WorkflowInitializer",function(t,i,n,o,a,r,s,c,u,d){function l(){o.path(e.APP_CONFIG.START_VIEW)}function f(){var e=c.defer();return n.isAuthenticated?(h().then(function(){l(),e.resolve()},e.reject),e.promise):(e.resolve(),e.promise)}function p(){var e=c.defer();return t.isLoading=!1,e.resolve(),e.promise}function m(){var e=c.defer();return t.isLoading=!0,e.resolve(),e.promise}function g(){return d.initWorkflows(e.APP_CONFIG.WORKFLOWS.LOGIN.AFTER)}function h(){return m().then(g).then(p)}function P(){t.isLoading=!1,n.config.auth0lib.$container=null,n.signin({connections:["instagram"],container:"login-box",icon:"../images/logo.png",dict:v},function(e,t){a.set("profile",e),a.set("token",t),h().then(l)},function(e){})}t.isLoading=!1;var v={loadingTitle:"carregando...",close:"fechar",signin:{title:"Seja bem-vindo!",signinText:"Entrar",signupText:"Cadastrar-se",usernamePlaceholder:"e-mail",emailPlaceholder:"e-mail",passwordPlaceholder:"Senha",separatorText:"ou",wrongEmailPasswordErrorText:"E-mail ou senha inválidos.",serverErrorText:"Você não está autorizado.",strategyEmailInvalid:"O e-mail é invalido.",strategyDomainInvalid:"O domínio {domain} não foi configurado.",returnUserLabel:"Da última vez você acessou como...",all:"Não é sua conta?",forgotText:"Esqueceu sua senha? Clique aqui."},signup:{serverErrorText:"Não foi possível se cadastrar."},reset:{serverErrorText:"Não foi possível resetar a senha."}};f().then(P),i.$on("refreshLogin",P)}])}(window),function(e){e.squid.login.config(["$routeProvider",function(t){t.when("/login",{viewUrl:e.APP_CONFIG.APP_DIR+"/modules/login/views/index.html",templateUrl:e.APP_CONFIG.VIEWS.TEMPLATES.LOGIN,pageTitle:"Login",secondaryNav:!0})}])}(window),function(e){function t(e,t,i){e.currentStep="step-1",e.TEXTS={STEP1:APP_CONFIG.CAMPAIGNS.UNIQUE_CAMPAIGN.ABOUT.TEXTS.STEP_1,STEP2:APP_CONFIG.CAMPAIGNS.UNIQUE_CAMPAIGN.ABOUT.TEXTS.STEP_2},e.next=function(){e.currentStep="step-2"},e.back=function(){e.currentStep="step-1"},e.cancel=function(){t.cancel()},e.ok=function(){t.hide(!0)}}var i={delay:1e4,close:"OK"};e.squid.login.controller("AboutCampaignController",["$scope","$mdDialog",t]),e.squid.login.factory("AboutCampaignModalService",["$rootScope","$q","$mdDialog","$mdToast","userService","store",function(n,o,a,r,s,c){function u(){return n.isSmallDevice?"bottom left":"top right"}function d(e){var t=o.defer();return s.update(e.app_metadata,function(i){t.resolve(e)},function(i){t.reject(e)}),t.promise}function l(e){var t=o.defer();e.app_metadata=e.app_metadata?e.app_metadata:{},e.app_metadata.acceptedTerms=!1,c.set("profile",e);var n=r.simple().content("Confirme a leitura sobre a campanha para poder navegar e participar.").action(i.close).parent($("main").get(0)).hideDelay(i.delay).highlightAction(!1).position(u());return r.show(n).then(function(e){}),d(e).then(t.resolve,t.reject),t.promise}function f(e,t){var i=o.defer();return t.app_metadata=t.app_metadata?t.app_metadata:{},t.app_metadata.acceptedTerms=e,c.set("profile",t),d(t).then(i.resolve,i.reject),i.promise}function p(i){var n=o.defer();return a.show({controller:t,templateUrl:e.APP_CONFIG.APP_DIR+"/modules/campaign/views/about-campaign-dialog.html",parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(e){f(e,i).then(n.resolve,n.reject)},function(){l(i).then(n.reject,n.reject)}),n.promise}return{openDialog:p}}])}(window),function(e){"use strict";function t(t,i,n){t.TEXTS=e.APP_CONFIG.CAMPAIGNS.UNIQUE_CAMPAIGN.ABOUT.TEXTS,t.currentText=t.TEXTS.length>0?t.TEXTS.first():{},t.isFirstText=function(e){return t.TEXTS.first().ORDER==e.ORDER},t.isLastText=function(e){return t.TEXTS.last().ORDER==e.ORDER},t.isCurrentText=function(e){return t.currentText.ORDER==e.ORDER},t.back=function(){var e=t.TEXTS.first(function(e){return e.ORDER<t.currentText.ORDER});t.currentText=e?e:t.currentText},t.next=function(){var e=t.TEXTS.first(function(e){return e.ORDER>t.currentText.ORDER});t.currentText=e?e:t.currentText},t.ok=function(){n.set("about-campaign-read",!0),i.hide()}}e.squid.campaign.controllers.AboutCampaignDialogController=t,e.squid.campaign.controller("AboutCampaignDialogController",["$scope","$mdDialog","store",t])}(window),function(e){"use strict";function t(t,n,o,a,r,s,c,u,d,l,f){function p(){return n.isSmallDevice?"bottom left":"top right"}function m(){return r.get("profile")}function g(){var t=m();return t.user_metadata&&t.user_metadata.infos?t.user_metadata.infos.first(function(t){return t.channelId==e.APP_CONFIG.APP_ID}):null}function h(e){var t=u.defer();return f.updateUserMetadata(e,t.resolve,t.reject),t.promise}function P(e){var t=g();return t||(t={}),t.acceptedTerms=e,h(t)}function v(){l.signout(),r.remove("profile"),r.remove("token"),$.jStorage.flush(),n.$broadcast("refreshLogin"),I()}function I(){a.path(e.APP_CONFIG.LOGIN_ROUTE)}function A(){var e=u.defer();P(!1).then(e.resolve,e.reject);var t=d.simple().content("Para participar da(s) campanha(s) você deve concordar com o regulamento.").action(i.close).parent($("main").get(0)).hideDelay(i.delay).highlightAction(!1).position(p());return v(),o(function(){d.show(t).then(function(e){})},800),e.promise}function T(){var e=u.defer();return P(!0).then(e.resolve,e.reject),e.promise}function O(){s.hide()}function w(){s.cancel()}function C(){O(),t.isLoading=!1}function _(){w(),t.isLoading=!1}t.isLoading=!1,t.TERMS_OF_USE=e.APP_CONFIG.TERMS_OF_USE,t.agree=function(){t.isLoading=!0,T().then(C)["catch"](_)},t.disagree=function(){t.isLoading=!0,A().then(C)["catch"](_)}}var i={delay:1e4,close:"OK"};e.squid.campaign.controllers.TermsOfUseDialogController=t,e.squid.campaign.controller("TermsOfUseDialogController",["$scope","$rootScope","$timeout","$location","store","$mdDialog","userService","$q","$mdToast","auth","squidSpidermanService",t])}(window),function(e){function t(e,t){this.initWorkflows=function(i){function n(){var e=arguments;async.eachSeries(e,function(e,t){e.init().then(function(e){t(null)})["catch"](t)},function(e){return e?o.reject(e):void o.resolve()})}var o=e.defer();return n.$inject=i,t.invoke(n),o.promise}}e.squid.workflow.factory("WorkflowInitializer",["$q","$injector",function(e,i){return new t(e,i)}])}(window),function(e){function t(t,n,o){return{init:function(){var a=t.defer(),r=n.get("about-campaign-read");return r?a.resolve():o.show({controller:i.AboutCampaignDialogController,templateUrl:e.APP_CONFIG.APP_DIR+"/modules/campaign/views/about-campaign-dialog.html",parent:angular.element(document.body),clickOutsideToClose:!1,escapeToClose:!1}).then(a.resolve,a.reject),a.promise}}}var i=e.squid.campaign.controllers;t.$inject=["$q","store","$mdDialog"];var n=t.$inject.concat(t);e.squid.workflow.factory("AboutCampaignWorkflowInitializer",n)}(window),function(e){function t(t,n,o){return{init:function(){var a=t.defer();return o.init().then(a.resolve)["catch"](function(){n.show({controller:i.TermsOfUseDialogController,templateUrl:e.APP_CONFIG.APP_DIR+"/modules/campaign/views/terms-of-use-dialog.html",parent:angular.element(document.body),clickOutsideToClose:!1,escapeToClose:!1}).then(a.resolve,a.reject)}),a.promise}}}var i=e.squid.campaign.controllers;t.$inject=["$q","$mdDialog","TermsOfUseValidator"],e.squid.workflow.factory("TermsOfUseWorkflowInitializer",t)}(window),function(e){function t(t,n,o,a){function r(){var t=a.getUserMetadata();return!!t&&e.APP_CONFIG.USER_METADATA.REQUIRED_INFOS.all(function(e){return!!t[e]})}return{init:function(){var n=t.defer();return r()?n.resolve():o.show({controller:i.UserMetadataDialogController,templateUrl:e.APP_CONFIG.APP_DIR+"/modules/user/views/user-metadata-dialog.html",parent:angular.element(document.body),clickOutsideToClose:!1,escapeToClose:!1}).then(n.resolve,n.reject),n.promise}}}var i=e.squid.user.controllers;t.$inject=["$q","store","$mdDialog","userMetadataHelper"];var n=t.$inject.concat(t);e.squid.workflow.factory("UserMetadataWorkflowInitializer",n)}(window),function(e){function t(e,t,i){return{init:function(){var t=e.defer();return i.termsIsAccepted()?t.resolve():t.reject(),t.promise}}}t.$inject=["$q","store","userMetadataHelper"];
var i=t.$inject.concat(t);e.squid.workflow.factory("TermsOfUseValidator",i)}(window),function(e){"use strict";e.squid.checkout.controller("CheckoutRescueModalController",["$scope","$modalInstance","prize","auth","checkoutService","userService",function(e,t,i,n,o,a){function r(){e.email!=n.profile.email?a.email({email:e.email},function(e){s()},function(t){e.validateStatus=t.data.message}):s()}function s(){o.getPrize({id:i.id},function(t){e.validateStatus=t.message},function(t){e.validateStatus=t.data.message,t.data.message.contains("e-mail")&&(l=!0)})}function c(){o.validate({id:i.id},function(t){e.validateStatus=t.status,t.status.contains("ok")&&(d=!0)},function(t){e.validateStatus=t.data.message})}function u(){c()}e.prize=i,e.email=n.profile.email,e.validateStatus="carregando...";var d=!1,l=!1;e.rescue=function(){r()},e.cancel=function(){t.dismiss("cancel")},u()}])}(window),function(e){"use strict";var t={delay:1e4,close:"OK"};e.squid.user.directive("userMetadataForm",["addressService","$q","$rootScope","$mdToast","syncPromise","squidSpidermanService",function(i,n,o,a,r,s){return{scope:{ngModel:"=",isSaving:"=",save:"="},templateUrl:e.APP_CONFIG.APP_DIR+"/modules/user/directives/user-metadata-form/user-metadata-form.html",link:function(c,u,d,l){function f(){return o.isSmallDevice?"bottom left":"top right"}function p(e){var t=n.defer();return e?(i.get({cep:e},t.resolve,t.reject),t.promise):(t.reject(),t.promise)}function m(e){return e.logradouro?e.logradouro+", "+e.complemento+", "+e.bairro:""}function g(e){c.ngModel.state=e.uf,c.ngModel.city=e.localidade,c.ngModel.address=m(e)}function h(){var e=n.defer();return s.getUserMetadata(e.resolve,e.reject),e.promise}function P(e){delete e.$promise,delete e.$resolved,e.birthday=moment(e.birthday)._d,c.ngModel=e}function v(e){var t=n.defer();return s.updateUserMetadata(e,t.resolve,t.reject),t.promise}function I(){c.isLoading=!0}function A(){c.isLoading=!1}function T(e){var i=a.simple().content(e).action(t.close).parent($("main").get(0)).hideDelay(t.delay).highlightAction(!1).position(f());a.show(i).then(function(e){})}function O(t){var i=e.APP_CONFIG.CHECKOUT.REQUIRED_INFOS.any(function(e){return!t[e]});return i&&T("Preencha os campos obrigatórios."),!i}function w(e){return c.isSaving=!1,e}function C(e){return function(t){c.isSaving=!1,e.reject(t)}}function _(){I(),h().then(r(P)).then(A)}c.isLoading=!1,c.states=["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"],c.save=function(){var e=n.defer();return O(c.ngModel)?(I(),c.isSaving=!0,v(c.ngModel).then(r(A)).then(r(w)).then(e.resolve)["catch"](C(e)),e.promise):(e.reject(),e.promise)},c.tryGetCep=function(e){e.length<8||p(e).then(r(g))},_()}}}])}(window);